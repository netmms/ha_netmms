#!/usr/bin/with-contenv sh
set -eu

# Read options from HA (env-injected as /data/options.json by supervisor)
/usr/bin/jq -r '
  def bool(v): if v then "true" else "false" end;
  . as $o |
  "# Autogenerated by Home Assistant add-on: Snapserver\n" +
  "[stream]\n" +
  "stream = \($o.stream)\n" +
  "sampleformat = \($o.sampleformat)\n" +
  "buffer = \($o.buffer_ms)\n" +
  "latency = \($o.latency_ms)\n" +
  "\n" +
  "[http]\n" +
  "enabled = " + bool($o.http_enabled) + "\n" +
  "bind_to_address = \($o.http_bind)\n" +
  "port = \($o.http_port)\n" +
  "\n" +
  "[tcp]\n" +
  "bind_to_address = \($o.rpc_bind)\n" +
  "port = \($o.rpc_port)\n" +
  "\n" +
  "[server]\n" +
  "datadir = /data\n" +
  "stream_port = \($o.stream_port)\n" +
  "[http]\n" +
  "enabled = " + bool($o.http_enabled) + "\n" +
  "bind_to_address = \($o.http_bind)\n" +
  "port = \($o.http_port)\n" +
  "doc_root = \($o.http_doc_root)\n"
' /data/options.json
